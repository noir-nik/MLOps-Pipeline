# Описание процесса обучения

## Обработка признакового пространства

### Обработка пропусков
В исходном наборе данных о продажах велосипедов пропуски отсутствуют, однако система спроектирована с учетом возможного появления пропусков в новых данных:

1. **Числовые переменные**: 
   - Для переменных `Customer_Age`, `Order_Quantity`, `Unit_Cost`, `Unit_Price` пропуски заполняются медианными значениями соответствующего столбца
   - Для целевой переменной `Profit` пропуски обрабатываются особым образом - записи с пропусками исключаются из обучающей выборки

2. **Категориальные переменные**:
   - Для переменных `Month`, `Age_Group`, `Customer_Gender`, `Country`, `State`, `Product_Category`, `Sub_Category`, `Product` пропуски заполняются наиболее частым значением (модой)
   - Создается дополнительный бинарный признак, указывающий на наличие пропуска в исходных данных

### Обработка категориальных переменных
Для категориальных переменных реализованы несколько методов кодирования:
1. **Обработка категориальных признаков**: 
   - Если обработка категориальных признаков включена и имеются такие столбцы, применяется `Pipeline` с `SimpleImputer` для заполнения пропусков наиболее частым значением и `OneHotEncoder` для кодирования (игнорируются неизвестные значения). 

2. **Обработка числовых признаков**:
   - Если обработка числовых признаков включена и имеются такие столбцы, применяется `Pipeline` с `SimpleImputer` для заполнения пропусков медианой и `StandardScaler` для масштабирования. Если масштабирование не требуется, используется `'passthrough'`.

### Обработка числовых переменных
Для числовых переменных реализованы следующие преобразования:

1. **Масштабирование**:
   - `StandardScaler`: для переменных с нормальным распределением
   - `MinMaxScaler`: для ограничения диапазона признаков в пределах [0, 1]
   - `RobustScaler`: для признаков с выбросами

2. **Обработка выбросов**:
   - Идентификация выбросов с помощью метода межквартильного размаха (IQR)
   - Winsorization: замена экстремальных значений на значения соответствующих квантилей (5% и 95%)

### Feature Engineering
Созданы дополнительные признаки для улучшения прогнозирующей способности моделей:

1. **Временные признаки**:
   - `is_holiday_season` - флаг для периода праздников (ноябрь-декабрь)
   - `quarter` - квартал года
   - `is_weekend` - флаг для выходных дней (если доступны данные о днях недели)

## Выбор и настройка моделей

### Рассматриваемые алгоритмы

1. **Линейная регрессия (Linear Regression)**
   - Базовая модель для исходной оценки
   - Интерпретируемые коэффициенты для оценки влияния признаков
   - Низкая вычислительная сложность, подходит для потоковой обработки

2. **k-ближайших соседей (KNN)**
   - Непараметрическая модель, способная улавливать сложные паттерны
   - Подходит для обнаружения локальных зависимостей
   - Гиперпараметры:
     - `n_neighbors`: [3, 5, 9, 15]

3. **Дерево решений (Decision Tree)**
   - Хорошо работает с нелинейными зависимостями
   - Устойчивость к выбросам
   - Гиперпараметры:
     - `max_depth`: [None, 5, 10, 15, 20]

### Методы оценки и валидации

1. **Метрики качества**:
   - RMSE (Root Mean Squared Error) - основная метрика для оптимизации
   - MAE (Mean Absolute Error) - вспомогательная метрика
   - R² (коэффициент детерминации) - для интерпретации объясненной дисперсии

2. **Методы валидации**:
   - TimeSeriesSplit - учитывает временную структуру данных
   - Количество фолдов: параметер `cv_folds` в конфигурации

### Выбор лучшей модели

Выбор лучшей модели осуществляется на основе следующего алгоритма:

1. Для каждой итерации (батча):
   - Обучение и валидация всех моделей с различными гиперпараметрами
   - Расчет метрик качества для каждой модели
   - Сохранение информации о моделях

2. Критерии выбора лучшей модели: 
   -  предпочтение модели с большим R²

3. Сохранение информации о лучшей модели:
   - Параметры модели
   - Метрики качества
   - Время обучения и прогнозирования


## Интерпретация модели

Для обеспечения интерпретируемости моделей реализованы следующие методы:

1. **Для линейной регрессии**:
   - Анализ коэффициентов
   - Расчет стандартизированных коэффициентов для сравнения влияния признаков
   - Визуализация коэффициентов в виде диаграмм

2. **Для дерева решений**:
   - Визуализация структуры дерева
   - Анализ важности признаков
   - Визуализация путей принятия решений

3. **Для KNN**:
   - Визуализация ближайших соседей
